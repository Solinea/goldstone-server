/**
 * Copyright 2014 Solinea, Inc.
 *
 * Licensed under the Solinea Software License Agreement (goldstone),
 * Version 1.0 (the "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at:
 *
 *     http://www.solinea.com/goldstone/LICENSE.pdf
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Author: Alex Jacobs
 */

// define collection and link to model

var StackedBarChartCollection = Backbone.Collection.extend({

    defaults: {},

    parse: function(data) {
        return this.dummyData;
        // return data;
    },

    model: StackedBarChartModel,

    initialize: function(options) {
        this.options = options || {};
        this.defaults = _.clone(this.defaults);
        this.defaults.urlPrefix = this.options.urlPrefix;
        this.defaults.reportParams = {};
        this.defaults.render = options.render;
        this.defaults.urlPrefix = options.urlPrefix;
        this.defaults.globalLookback = $('#global-lookback-range').val();
        this.urlGenerator();
        this.fetch({
            success: function(data, response, options) {
                console.log('success', options.xhr.getAllResponseHeaders());
            },
            error: function() {
                console.log('error');
            }
        });
    },

    urlGenerator: function() {

        var ns = this.defaults;

        ns.reportParams.end = +new Date();
        ns.reportParams.start = (+new Date()) - (ns.globalLookback * 1000 * 60);
        ns.reportParams.interval = '' + Math.round(0.357 * ns.globalLookback) + "s";

        this.url = goldstone.nova.apiPerf.timeRange._url(null, ns.reportParams.start, ns.reportParams.end, ns.reportParams.interval, ns.render, ns.urlPrefix);
        console.log('this.url would be:', this.url);
        this.url = "/glance/api_perf?start=111&end=112&interval=3600s&render=false";
        console.log('but this.url is currently:', this.url);
    },

    dummyData: {
        "1418844672000": [0, "2014-12-17T19:31:12.000Z", 0],
        "1418846016000": [0, "2014-12-17T19:53:36.000Z", 0],
        "1418844693000": [0, "2014-12-17T19:31:33.000Z", 0],
        "1418844714000": [0, "2014-12-17T19:31:54.000Z", 0],
        "1418844903000": [0, "2014-12-17T19:35:03.000Z", 0],
        "1418844735000": [0, "2014-12-17T19:32:15.000Z", 0],
        "1418846625000": [0, "2014-12-17T20:03:45.000Z", 0],
        "1418846709000": [0, "2014-12-17T20:05:09.000Z", 0],
        "1418846793000": [0, "2014-12-17T20:06:33.000Z", 0],
        "1418844756000": [0, "2014-12-17T19:32:36.000Z", 0],
        "1418846478000": [0, "2014-12-17T20:01:18.000Z", 0],
        "1418847045000": [0, "2014-12-17T20:10:45.000Z", 0],
        "1418847129000": [0, "2014-12-17T20:12:09.000Z", 0],
        "1418847213000": [0, "2014-12-17T20:13:33.000Z", 0],
        "1418847297000": [2, "2014-12-17T20:14:57.000Z", 0],
        "1418844777000": [0, "2014-12-17T19:32:57.000Z", 0],
        "1418844798000": [0, "2014-12-17T19:33:18.000Z", 0],
        "1418846037000": [0, "2014-12-17T19:53:57.000Z", 0],
        "1418844819000": [0, "2014-12-17T19:33:39.000Z", 0],
        "1418844840000": [0, "2014-12-17T19:34:00.000Z", 0],
        "1418844924000": [0, "2014-12-17T19:35:24.000Z", 0],
        "1418846961000": [0, "2014-12-17T20:09:21.000Z", 0],
        "1418846205000": [0, "2014-12-17T19:56:45.000Z", 0],
        "1418846226000": [0, "2014-12-17T19:57:06.000Z", 0],
        "1418846499000": [0, "2014-12-17T20:01:39.000Z", 0],
        "1418846247000": [0, "2014-12-17T19:57:27.000Z", 0],
        "1418846856000": [0, "2014-12-17T20:07:36.000Z", 0],
        "1418846268000": [0, "2014-12-17T19:57:48.000Z", 0],
        "1418846058000": [0, "2014-12-17T19:54:18.000Z", 0],
        "1418846289000": [0, "2014-12-17T19:58:09.000Z", 0],
        "1418844966000": [0, "2014-12-17T19:36:06.000Z", 0],
        "1418844945000": [0, "2014-12-17T19:35:45.000Z", 0],
        "1418846331000": [0, "2014-12-17T19:58:51.000Z", 0],
        "1418845008000": [0, "2014-12-17T19:36:48.000Z", 0],
        "1418846520000": [0, "2014-12-17T20:02:00.000Z", 0],
        "1418845029000": [0, "2014-12-17T19:37:09.000Z", 0],
        "1418845050000": [0, "2014-12-17T19:37:30.000Z", 0],
        "1418846079000": [0, "2014-12-17T19:54:39.000Z", 0],
        "1418845071000": [0, "2014-12-17T19:37:51.000Z", 0],
        "1418846604000": [0, "2014-12-17T20:03:24.000Z", 0],
        "1418846688000": [0, "2014-12-17T20:04:48.000Z", 0],
        "1418846772000": [0, "2014-12-17T20:06:12.000Z", 0],
        "1418845092000": [0, "2014-12-17T19:38:12.000Z", 0],
        "1418846310000": [0, "2014-12-17T19:58:30.000Z", 0],
        "1418847024000": [0, "2014-12-17T20:10:24.000Z", 0],
        "1418847108000": [0, "2014-12-17T20:11:48.000Z", 0],
        "1418847192000": [0, "2014-12-17T20:13:12.000Z", 0],
        "1418847276000": [0, "2014-12-17T20:14:36.000Z", 0],
        "1418845113000": [0, "2014-12-17T19:38:33.000Z", 0],
        "1418845134000": [0, "2014-12-17T19:38:54.000Z", 0],
        "1418846541000": [0, "2014-12-17T20:02:21.000Z", 0],
        "1418845155000": [0, "2014-12-17T19:39:15.000Z", 0],
        "1418845176000": [0, "2014-12-17T19:39:36.000Z", 0],
        "1418846100000": [0, "2014-12-17T19:55:00.000Z", 0],
        "1418845197000": [0, "2014-12-17T19:39:57.000Z", 0],
        "1418845218000": [0, "2014-12-17T19:40:18.000Z", 0],
        "1418844987000": [0, "2014-12-17T19:36:27.000Z", 0],
        "1418845239000": [0, "2014-12-17T19:40:39.000Z", 0],
        "1418845260000": [0, "2014-12-17T19:41:00.000Z", 0],
        "1418846562000": [0, "2014-12-17T20:02:42.000Z", 0],
        "1418845281000": [0, "2014-12-17T19:41:21.000Z", 0],
        "1418845302000": [0, "2014-12-17T19:41:42.000Z", 0],
        "1418846121000": [0, "2014-12-17T19:55:21.000Z", 0],
        "1418845323000": [0, "2014-12-17T19:42:03.000Z", 0],
        "1418845344000": [0, "2014-12-17T19:42:24.000Z", 0],
        "1418846352000": [0, "2014-12-17T19:59:12.000Z", 0],
        "1418845365000": [0, "2014-12-17T19:42:45.000Z", 0],
        "1418845386000": [0, "2014-12-17T19:43:06.000Z", 0],
        "1418846583000": [0, "2014-12-17T20:03:03.000Z", 0],
        "1418846919000": [0, "2014-12-17T20:08:39.000Z", 0],
        "1418845407000": [0, "2014-12-17T19:43:27.000Z", 0],
        "1418846667000": [0, "2014-12-17T20:04:27.000Z", 0],
        "1418846751000": [0, "2014-12-17T20:05:51.000Z", 0],
        "1418846835000": [0, "2014-12-17T20:07:15.000Z", 0],
        "1418845428000": [0, "2014-12-17T19:43:48.000Z", 0],
        "1418846142000": [0, "2014-12-17T19:55:42.000Z", 0],
        "1418847087000": [0, "2014-12-17T20:11:27.000Z", 0],
        "1418847171000": [0, "2014-12-17T20:12:51.000Z", 0],
        "1418847255000": [0, "2014-12-17T20:14:15.000Z", 0],
        "1418845449000": [0, "2014-12-17T19:44:09.000Z", 0],
        "1418846940000": [0, "2014-12-17T20:09:00.000Z", 0],
        "1418845470000": [0, "2014-12-17T19:44:30.000Z", 0],
        "1418846373000": [0, "2014-12-17T19:59:33.000Z", 0],
        "1418845491000": [1, "2014-12-17T19:44:51.000Z", 0],
        "1418845512000": [0, "2014-12-17T19:45:12.000Z", 0],
        "1418844588000": [2, "2014-12-17T19:29:48.000Z", 0],
        "1418845533000": [0, "2014-12-17T19:45:33.000Z", 0],
        "1418845554000": [0, "2014-12-17T19:45:54.000Z", 0],
        "1418846163000": [0, "2014-12-17T19:56:03.000Z", 0],
        "1418845575000": [0, "2014-12-17T19:46:15.000Z", 0],
        "1418845596000": [0, "2014-12-17T19:46:36.000Z", 0],
        "1418846394000": [3, "2014-12-17T19:59:54.000Z", 0],
        "1418845617000": [0, "2014-12-17T19:46:57.000Z", 0],
        "1418847003000": [0, "2014-12-17T20:10:03.000Z", 0],
        "1418845638000": [0, "2014-12-17T19:47:18.000Z", 0],
        "1418844609000": [0, "2014-12-17T19:30:09.000Z", 0],
        "1418845659000": [0, "2014-12-17T19:47:39.000Z", 0],
        "1418845680000": [0, "2014-12-17T19:48:00.000Z", 0],
        "1418846184000": [0, "2014-12-17T19:56:24.000Z", 0],
        "1418846898000": [0, "2014-12-17T20:08:18.000Z", 0],
        "1418845701000": [0, "2014-12-17T19:48:21.000Z", 0],
        "1418845722000": [0, "2014-12-17T19:48:42.000Z", 0],
        "1418846415000": [0, "2014-12-17T20:00:15.000Z", 0],
        "1418845743000": [0, "2014-12-17T19:49:03.000Z", 0],
        "1418846646000": [0, "2014-12-17T20:04:06.000Z", 0],
        "1418846730000": [0, "2014-12-17T20:05:30.000Z", 0],
        "1418846814000": [0, "2014-12-17T20:06:54.000Z", 0],
        "1418845764000": [0, "2014-12-17T19:49:24.000Z", 0],
        "1418844630000": [0, "2014-12-17T19:30:30.000Z", 0],
        "1418847066000": [0, "2014-12-17T20:11:06.000Z", 0],
        "1418847150000": [0, "2014-12-17T20:12:30.000Z", 0],
        "1418847234000": [0, "2014-12-17T20:13:54.000Z", 0],
        "1418845785000": [0, "2014-12-17T19:49:45.000Z", 0],
        "1418845806000": [0, "2014-12-17T19:50:06.000Z", 0],
        "1418844861000": [0, "2014-12-17T19:34:21.000Z", 0],
        "1418845827000": [0, "2014-12-17T19:50:27.000Z", 0],
        "1418845848000": [0, "2014-12-17T19:50:48.000Z", 0],
        "1418846436000": [0, "2014-12-17T20:00:36.000Z", 0],
        "1418845869000": [0, "2014-12-17T19:51:09.000Z", 0],
        "1418845890000": [0, "2014-12-17T19:51:30.000Z", 0],
        "1418844651000": [0, "2014-12-17T19:30:51.000Z", 0],
        "1418845911000": [0, "2014-12-17T19:51:51.000Z", 0],
        "1418846982000": [0, "2014-12-17T20:09:42.000Z", 0],
        "1418845932000": [0, "2014-12-17T19:52:12.000Z", 0],
        "1418844882000": [0, "2014-12-17T19:34:42.000Z", 0],
        "1418845953000": [0, "2014-12-17T19:52:33.000Z", 0],
        "1418846877000": [0, "2014-12-17T20:07:57.000Z", 0],
        "1418845974000": [0, "2014-12-17T19:52:54.000Z", 0],
        "1418846457000": [0, "2014-12-17T20:00:57.000Z", 0],
        "1418845995000": [0, "2014-12-17T19:53:15.000Z", 0]
    }


    /* dummyData: [{
        State: "AL",
        "under 5": 310504,
        "5-13": 552339,
        "14-17": 259034,
        "18-24": 450818,
        "25-44": 1231572,
        "45-64": 1215966,
        "65+": 641667
    }, {
        State: "AK",
        "under 5": 52083,
        "5-13": 85640,
        "14-17": 42153,
        "18-24": 74257,
        "25-44": 198724,
        "45-64": 183159,
        "65+": 50277
    }, {
        State: "AZ",
        "under 5": 515910,
        "5-13": 828669,
        "14-17": 362642,
        "18-24": 601943,
        "25-44": 1804762,
        "45-64": 1523681,
        "65+": 862573
    }, {
        State: "AR",
        "under 5": 202070,
        "5-13": 343207,
        "14-17": 157204,
        "18-24": 264160,
        "25-44": 754420,
        "45-64": 727124,
        "65+": 407205
    }, {
        State: "CA",
        "under 5": 2704659,
        "5-13": 4499890,
        "14-17": 2159981,
        "18-24": 3853788,
        "25-44": 10604510,
        "45-64": 8819342,
        "65+": 4114496
    }, {
        State: "CO",
        "under 5": 358280,
        "5-13": 587154,
        "14-17": 261701,
        "18-24": 466194,
        "25-44": 1464939,
        "45-64": 1290094,
        "65+": 511094
    }, {
        State: "CT",
        "under 5": 211637,
        "5-13": 403658,
        "14-17": 196918,
        "18-24": 325110,
        "25-44": 916955,
        "45-64": 968967,
        "65+": 478007
    }, {
        State: "DE",
        "under 5": 59319,
        "5-13": 99496,
        "14-17": 47414,
        "18-24": 84464,
        "25-44": 230183,
        "45-64": 230528,
        "65+": 121688
    }, {
        State: "DC",
        "under 5": 36352,
        "5-13": 50439,
        "14-17": 25225,
        "18-24": 75569,
        "25-44": 193557,
        "45-64": 140043,
        "65+": 70648
    }, {
        State: "FL",
        "under 5": 1140516,
        "5-13": 1938695,
        "14-17": 925060,
        "18-24": 1607297,
        "25-44": 4782119,
        "45-64": 4746856,
        "65+": 3187797
    }, {
        State: "GA",
        "under 5": 740521,
        "5-13": 1250460,
        "14-17": 557860,
        "18-24": 919876,
        "25-44": 2846985,
        "45-64": 2389018,
        "65+": 981024
    }, {
        State: "HI",
        "under 5": 87207,
        "5-13": 134025,
        "14-17": 64011,
        "18-24": 124834,
        "25-44": 356237,
        "45-64": 331817,
        "65+": 190067
    }, {
        State: "ID",
        "under 5": 121746,
        "5-13": 201192,
        "14-17": 89702,
        "18-24": 147606,
        "25-44": 406247,
        "45-64": 375173,
        "65+": 182150
    }, {
        State: "IL",
        "under 5": 894368,
        "5-13": 1558919,
        "14-17": 725973,
        "18-24": 1311479,
        "25-44": 3596343,
        "45-64": 3239173,
        "65+": 1575308
    }, {
        State: "IN",
        "under 5": 443089,
        "5-13": 780199,
        "14-17": 361393,
        "18-24": 605863,
        "25-44": 1724528,
        "45-64": 1647881,
        "65+": 813839
    }, {
        State: "IA",
        "under 5": 201321,
        "5-13": 345409,
        "14-17": 165883,
        "18-24": 306398,
        "25-44": 750505,
        "45-64": 788485,
        "65+": 444554
    }, {
        State: "KS",
        "under 5": 202529,
        "5-13": 342134,
        "14-17": 155822,
        "18-24": 293114,
        "25-44": 728166,
        "45-64": 713663,
        "65+": 366706
    }, {
        State: "KY",
        "under 5": 284601,
        "5-13": 493536,
        "14-17": 229927,
        "18-24": 381394,
        "25-44": 1179637,
        "45-64": 1134283,
        "65+": 565867
    }, {
        State: "LA",
        "under 5": 310716,
        "5-13": 542341,
        "14-17": 254916,
        "18-24": 471275,
        "25-44": 1162463,
        "45-64": 1128771,
        "65+": 540314
    }, {
        State: "ME",
        "under 5": 71459,
        "5-13": 133656,
        "14-17": 69752,
        "18-24": 112682,
        "25-44": 331809,
        "45-64": 397911,
        "65+": 199187
    }, {
        State: "MD",
        "under 5": 371787,
        "5-13": 651923,
        "14-17": 316873,
        "18-24": 543470,
        "25-44": 1556225,
        "45-64": 1513754,
        "65+": 679565
    }, {
        State: "MA",
        "under 5": 383568,
        "5-13": 701752,
        "14-17": 341713,
        "18-24": 665879,
        "25-44": 1782449,
        "45-64": 1751508,
        "65+": 871098
    }, {
        State: "MI",
        "under 5": 625526,
        "5-13": 1179503,
        "14-17": 585169,
        "18-24": 974480,
        "25-44": 2628322,
        "45-64": 2706100,
        "65+": 1304322
    }, {
        State: "MN",
        "under 5": 358471,
        "5-13": 606802,
        "14-17": 289371,
        "18-24": 507289,
        "25-44": 1416063,
        "45-64": 1391878,
        "65+": 650519
    }, {
        State: "MS",
        "under 5": 220813,
        "5-13": 371502,
        "14-17": 174405,
        "18-24": 305964,
        "25-44": 764203,
        "45-64": 730133,
        "65+": 371598
    }, {
        State: "MO",
        "under 5": 399450,
        "5-13": 690476,
        "14-17": 331543,
        "18-24": 560463,
        "25-44": 1569626,
        "45-64": 1554812,
        "65+": 805235
    }, {
        State: "MT",
        "under 5": 61114,
        "5-13": 106088,
        "14-17": 53156,
        "18-24": 95232,
        "25-44": 236297,
        "45-64": 278241,
        "65+": 137312
    }, {
        State: "NE",
        "under 5": 132092,
        "5-13": 215265,
        "14-17": 99638,
        "18-24": 186657,
        "25-44": 457177,
        "45-64": 451756,
        "65+": 240847
    }, {
        State: "NV",
        "under 5": 199175,
        "5-13": 325650,
        "14-17": 142976,
        "18-24": 212379,
        "25-44": 769913,
        "45-64": 653357,
        "65+": 296717
    }, {
        State: "NH",
        "under 5": 75297,
        "5-13": 144235,
        "14-17": 73826,
        "18-24": 119114,
        "25-44": 345109,
        "45-64": 388250,
        "65+": 169978
    }, {
        State: "NJ",
        "under 5": 557421,
        "5-13": 1011656,
        "14-17": 478505,
        "18-24": 769321,
        "25-44": 2379649,
        "45-64": 2335168,
        "65+": 1150941
    }, {
        State: "NM",
        "under 5": 148323,
        "5-13": 241326,
        "14-17": 112801,
        "18-24": 203097,
        "25-44": 517154,
        "45-64": 501604,
        "65+": 260051
    }, {
        State: "NY",
        "under 5": 1208495,
        "5-13": 2141490,
        "14-17": 1058031,
        "18-24": 1999120,
        "25-44": 5355235,
        "45-64": 5120254,
        "65+": 2607672
    }, {
        State: "NC",
        "under 5": 652823,
        "5-13": 1097890,
        "14-17": 492964,
        "18-24": 883397,
        "25-44": 2575603,
        "45-64": 2380685,
        "65+": 1139052
    }, {
        State: "ND",
        "under 5": 41896,
        "5-13": 67358,
        "14-17": 33794,
        "18-24": 82629,
        "25-44": 154913,
        "45-64": 166615,
        "65+": 94276
    }, {
        State: "OH",
        "under 5": 743750,
        "5-13": 1340492,
        "14-17": 646135,
        "18-24": 1081734,
        "25-44": 3019147,
        "45-64": 3083815,
        "65+": 1570837
    }, {
        State: "OK",
        "under 5": 266547,
        "5-13": 438926,
        "14-17": 200562,
        "18-24": 369916,
        "25-44": 957085,
        "45-64": 918688,
        "65+": 490637
    }, {
        State: "OR",
        "under 5": 243483,
        "5-13": 424167,
        "14-17": 199925,
        "18-24": 338162,
        "25-44": 1044056,
        "45-64": 1036269,
        "65+": 503998
    }, {
        State: "PA",
        "under 5": 737462,
        "5-13": 1345341,
        "14-17": 679201,
        "18-24": 1203944,
        "25-44": 3157759,
        "45-64": 3414001,
        "65+": 1910571
    }, {
        State: "RI",
        "under 5": 60934,
        "5-13": 111408,
        "14-17": 56198,
        "18-24": 114502,
        "25-44": 277779,
        "45-64": 282321,
        "65+": 147646
    }, {
        State: "SC",
        "under 5": 303024,
        "5-13": 517803,
        "14-17": 245400,
        "18-24": 438147,
        "25-44": 1193112,
        "45-64": 1186019,
        "65+": 596295
    }, {
        State: "SD",
        "under 5": 58566,
        "5-13": 94438,
        "14-17": 45305,
        "18-24": 82869,
        "25-44": 196738,
        "45-64": 210178,
        "65+": 116100
    }, {
        State: "TN",
        "under 5": 416334,
        "5-13": 725948,
        "14-17": 336312,
        "18-24": 550612,
        "25-44": 1719433,
        "45-64": 1646623,
        "65+": 819626
    }, {
        State: "TX",
        "under 5": 2027307,
        "5-13": 3277946,
        "14-17": 1420518,
        "18-24": 2454721,
        "25-44": 7017731,
        "45-64": 5656528,
        "65+": 2472223
    }, {
        State: "UT",
        "under 5": 268916,
        "5-13": 413034,
        "14-17": 167685,
        "18-24": 329585,
        "25-44": 772024,
        "45-64": 538978,
        "65+": 246202
    }, {
        State: "VT",
        "under 5": 32635,
        "5-13": 62538,
        "14-17": 33757,
        "18-24": 61679,
        "25-44": 155419,
        "45-64": 188593,
        "65+": 86649
    }, {
        State: "VA",
        "under 5": 522672,
        "5-13": 887525,
        "14-17": 413004,
        "18-24": 768475,
        "25-44": 2203286,
        "45-64": 2033550,
        "65+": 940577
    }, {
        State: "WA",
        "under 5": 433119,
        "5-13": 750274,
        "14-17": 357782,
        "18-24": 610378,
        "25-44": 1850983,
        "45-64": 1762811,
        "65+": 783877
    }, {
        State: "WV",
        "under 5": 105435,
        "5-13": 189649,
        "14-17": 91074,
        "18-24": 157989,
        "25-44": 470749,
        "45-64": 514505,
        "65+": 285067
    }, {
        State: "WI",
        "under 5": 362277,
        "5-13": 640286,
        "14-17": 311849,
        "18-24": 553914,
        "25-44": 1487457,
        "45-64": 1522038,
        "65+": 750146
    }, {
        State: "WY",
        "under 5": 38253,
        "5-13": 60890,
        "14-17": 29314,
        "18-24": 53980,
        "25-44": 137338,
        "45-64": 147279,
        "65+": 65614
    }]*/

});
