<!--
Copyright 2015 Solinea, Inc.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!-- django will render base.html, and then render router.html into block content  -->
{% load staticfiles %}
<html>
    <head>

        <!-- outsourced -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Goldstone - Login</title>
        <link rel="icon" href="/static/images/favicon.ico">
        <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/static/css/global.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/static/css/redesign.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/static/css/responsive.css" media="screen">
        <!--[if lt IE 9]>
        <script src="assets/js/html5shiv.min.js"></script>
        <![endif]-->
        <!-- end outsourced -->

        <script src="/static/html5shiv.min.js"></script>

        {% block localcss %}
        {% endblock %}
    </head>
    <body class="login-page">
        <!--Page Wrapper Start-->
        <div class="wrapper">

            <!--Content Area Start-->
            <div class="content">
                <div class="container">
                    <div class="row">
                        <div class="login-area col-sm-6 col-md-4 center-block">
                            <h1>
                            <span class="logo-large">&nbsp;</span>
                            </h1>

        <!-- subclass and replace for password reset/confirm pages -->
        {% block localhtml %}
                            <form class="login-form">
                                <input type="text" name="username" placeholder="Username">
                                <input type="password" name="password" placeholder="Password">
                                <label class="chkbox" for="chk1">
                                  <input type="checkbox" value="remember" id="chk1"> <span class="chk-lab"></span> Remember me
                                </label>
                                <button class="full-width-btn" type="submit">Sign In</button>
                                <a class="reset-pw" href="#">reset password</a>
                            </form>
        {% endblock %}

                        </div>
                    </div>
                </div>
            </div>
            <!--Content Area End-->
            <!--Footer Start-->
            <footer class="footer">
                <div class="container">
                    <div class="row">
                        <span class="copyright"><strong>Copyright 2014-2015</strong> Solinea, Inc.</span>
                        <span class="license">License</span>
                    </div>
                </div>
            </footer>
            <!--Footer End-->
        </div>
        <!--Page Wrapper End-->
        <script src="{% static 'bundle/libs.js' %}"></script>
        <script src="{% static 'bundle/bundle.js' %}"></script>
        {% block localjs %}

        <script>

        $(function() {

            var trimInputField = function(selector) {
                var trimmedContent = $(selector).val().trim();
                $(selector).val(trimmedContent);
            };

            var submitRequest = function(input) {
                var self = this;

                // Upon clicking the submit button, the serialized user input is sent
                // via $.post to check the credentials. If successful, invoke "done"
                // if not, invoke "fail"

                $.post('/accounts/login/', input, function() {})
                    .done(function(success) {

                        // store the auth token
                        self.storeAuthToken(success.auth_token);

                        // must follow storing token otherwise call will fail with 401
                        self.checkForInstalledApps();
                        self.redirectPostSuccessfulAuth();
                    })
                    .fail(function(fail) {
                        // and add a message to the top of the screen that logs what
                        // is returned from the call

                        try {
                            goldstone.raiseInfo(fail.responseJSON.non_field_errors[0]);
                        } catch (e) {
                            goldstone.raiseInfo(fail.responseText);
                            console.log(e);
                        }

                    });
            };

            var storeAuthToken = function(token) {
                localStorage.setItem('userToken', token);
            };

            var redirectPostSuccessfulAuth = function() {
                location.href = '#';
            };


            $('.login-form').on('submit', function(e) {
                e.preventDefault();
                trimInputField('[name="username"]');
                submitRequest($(this).serialize());
            });




        });

        </script>

        {% endblock %}
    </body>
</html>
