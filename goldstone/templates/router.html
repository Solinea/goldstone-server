<!--
 Copyright 2015 Solinea, Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
{% extends "base.html" %}
{% load staticfiles %}
{% load custom_filters %}
{% block localcss %}
{% endblock %}
{% block localjs %}
    <script>
        // the main container for views under the Backbone Router schema
        app = {};
        app.localStorageKeys = ['addons', 'userToken'];

        // assign "ajax-loader-solinea-blue" spinner gif
        var blueSpinnerGif = "{% static 'images/ajax-loader-solinea-blue.gif' %}";

        $(document).ready(function () {

            /*
            LogoutIcon encapsulates the initialization of the $(document) listner
            for ajaxSend events and uses xhr.setRequestHeader to append the Auth
            token on all subsequent api calls. It also serves to handle 401 auth
            errors, removing any existing token, and redirecting to the login page.

            authLogoutIcon is subscibed to a trigger emmitted by the gsRouter in
            router.html. Following that, only if there is a token
            present (expired or not), it will use css to show/hide the logout icon
            in the top-right corner of the page.

            finally, authLogoutIcon prunes old unused keys in localStorage
            */

            app.authLogoutIcon = new LogoutIcon({
                el: ".logout-icon-container"
            });

            app.addonMenuView = new AddonMenuView({
                el: ".addon-menu-view-container"
            });

            // append global selectors to page
            app.globalLookbackRefreshSelectors = new GlobalLookbackRefreshButtonsView({});
            $('.global-range-refresh-container').append(app.globalLookbackRefreshSelectors.el);

            // kick off the router
            app.gsRouter = new GoldstoneRouter();
            Backbone.history.start();

            // subscribe the authLogoutIcon to the router
            // object which will emit a trigger when a
            // view is switched out.
            app.authLogoutIcon.listenTo(app.gsRouter, 'switchingView', function() {
                // viewSwitchTriggered defined
                // in authLogoutIconView
                this.viewSwitchTriggered();
            });
        });

    </script>
{% endblock %}
{% block content %}
    <div class="router-content-container"></div>
{% endblock %}
